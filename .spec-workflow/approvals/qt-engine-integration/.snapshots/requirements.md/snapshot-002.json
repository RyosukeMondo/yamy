{
  "id": "snapshot_1765698616564_y3trsok50",
  "approvalId": "approval_1765593021667_q8qdk1t5h",
  "approvalTitle": "Requirements: Qt Engine Integration",
  "version": 2,
  "timestamp": "2025-12-14T07:50:16.564Z",
  "trigger": "approved",
  "status": "pending",
  "content": "# Requirements: Qt Engine Integration\n\n## Overview\nReplace the stub Engine implementation in the Qt GUI application with the real keyboard remapping engine to enable actual key mapping functionality on Linux.\n\n## User Stories\n\n### US-1: Real Keyboard Remapping\n**As a** Linux user\n**I want** the Qt GUI to use the real keyboard remapping engine\n**So that** I can actually remap keys according to my .mayu configuration files\n\n**Acceptance Criteria:**\n- WHEN I load a .mayu configuration file\n- THEN the real engine parses and applies the key mappings\n- AND keyboard inputs are captured and remapped according to the configuration\n\n### US-2: Configuration Loading\n**As a** user\n**I want** to load and switch between different .mayu configuration files\n**So that** I can use different key mappings for different tasks\n\n**Acceptance Criteria:**\n- WHEN I select a configuration file in the Settings dialog\n- THEN the real engine loads and validates the .mayu file\n- AND the engine applies the new configuration without crashing\n- AND I receive notification of success or error\n\n### US-3: Engine State Management\n**As a** user\n**I want** to enable/disable the engine and see its current state\n**So that** I can control when key remapping is active\n\n**Acceptance Criteria:**\n- WHEN I click Enable/Disable in the tray menu\n- THEN the real engine starts/stops capturing keyboard input\n- AND the tray icon reflects the current state (running/stopped)\n- AND keyboard input is only remapped when enabled\n\n### US-4: Real-time Status Information\n**As a** user\n**I want** to see accurate status information (key count, uptime, current keymap)\n**So that** I can verify the engine is working correctly\n\n**Acceptance Criteria:**\n- WHEN I check status via yamy-ctl or the GUI\n- THEN I see real metrics from the actual engine (not stub data)\n- AND the key count increases when I press keys\n- AND the current keymap matches the active configuration\n\n### US-5: Error Handling\n**As a** user\n**I want** clear error messages when configuration loading fails\n**So that** I can fix problems in my .mayu files\n\n**Acceptance Criteria:**\n- WHEN the engine fails to parse a .mayu file\n- THEN I receive a desktop notification with the error message\n- AND the error is logged for debugging\n- AND the engine doesn't crash\n\n## Functional Requirements\n\n### FR-1: Engine Lifecycle Management\nThe application shall instantiate and manage the real Engine class from `src/core/engine/engine.h` instead of the stub implementation.\n\n**EARS Format:**\n- **WHEN** the Qt application starts\n- **THEN** the system shall create an instance of the real Engine\n- **AND** initialize it with the Linux platform implementations (InputHook, InputInjector, WindowSystem)\n\n### FR-2: Platform Integration\nThe real Engine shall use the fully-implemented Linux platform abstractions.\n\n**EARS Format:**\n- **WHEN** the Engine is created\n- **THEN** the system shall provide instances of:\n  - `InputHookLinux` for keyboard capture\n  - `InputInjectorLinux` for key injection\n  - `WindowSystemLinux` for window management\n  - `IPCChannelLinux` for inter-process communication\n\n### FR-3: Configuration Loading\nThe real Engine shall load and parse .mayu configuration files.\n\n**EARS Format:**\n- **WHEN** a user selects a .mayu file path\n- **THEN** the Engine shall parse the file using the Setting/Parser subsystem\n- **AND** validate the configuration syntax\n- **AND** notify the GUI of success or failure\n\n### FR-4: GUI-Engine Communication\nThe GUI shall communicate with the real Engine through a well-defined interface.\n\n**EARS Format:**\n- **WHEN** the GUI needs engine status\n- **THEN** the system shall query the real Engine's state\n- **AND** return actual runtime data (not mock values)\n\n### FR-5: Session Persistence\nThe Engine state shall be persisted and restored across application restarts.\n\n**EARS Format:**\n- **WHEN** the application exits\n- **THEN** the system shall save the current configuration path and engine state\n- **WHEN** the application starts\n- **THEN** the system shall restore the previous configuration\n\n## Non-Functional Requirements\n\n### NFR-1: Performance\n- Engine initialization shall complete within 500ms\n- Configuration loading shall complete within 2 seconds for typical .mayu files\n- Key event latency shall be less than 10ms (p99)\n\n### NFR-2: Stability\n- The application shall not crash if a .mayu file contains syntax errors\n- The Engine shall handle invalid input gracefully\n- The application shall remain responsive during configuration loading\n\n### NFR-3: Compatibility\n- The integrated solution shall work with existing .mayu configuration files\n- All Qt GUI features (tray icon, dialogs, IPC) shall continue to function\n- The solution shall not break Windows compatibility\n\n### NFR-4: Maintainability\n- The integration shall use the existing Engine API without modifications\n- Platform-specific code shall remain isolated in `src/platform/linux/`\n- The solution shall not introduce circular dependencies\n\n## Constraints\n\n### Technical Constraints\n- Must use the existing `Engine` class from `src/core/engine/engine.h`\n- Must not modify the core Engine implementation\n- Must maintain compatibility with the Qt GUI framework\n- Must use C++17 standard\n\n### Platform Constraints\n- Linux-specific integration in `main_qt.cpp`\n- Must use existing Linux platform implementations (InputHook, InputInjector, WindowSystem)\n- Must work with X11 window system\n\n## Dependencies\n\n### Internal Dependencies\n- Real Engine class (`src/core/engine/engine.h`)\n- Linux platform implementations (`src/platform/linux/`)\n- Setting/Parser subsystem (`src/core/settings/`)\n- Qt GUI components (`src/ui/qt/`)\n\n### External Dependencies\n- Qt5 (Core, Widgets, X11Extras)\n- X11 libraries (libX11, libXrandr)\n- Linux kernel uinput/evdev support\n\n## Success Metrics\n\n1. **Functional Success**: All user stories pass acceptance criteria\n2. **Performance**: Key remapping latency < 10ms (p99)\n3. **Reliability**: No crashes during 1-hour continuous operation with active key remapping\n4. **User Validation**: User confirms keyboard remapping works as expected with their .mayu files\n",
  "fileStats": {
    "size": 6128,
    "lines": 163,
    "lastModified": "2025-12-13T02:26:56.583Z"
  },
  "comments": []
}