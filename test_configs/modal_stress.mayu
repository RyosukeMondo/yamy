#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# modal_stress.mayu - Stress Test Configuration for Modal Modifiers
# Tests maximum capacity: all 20 modal modifiers, 100 number modifiers,
# complex combinations, edge cases
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

include "109_clean.mayu"

#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# All 20 Modal Modifiers (mod0 - mod19)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
mod mod0 = !!Q
mod mod1 = !!W
mod mod2 = !!E
mod mod3 = !!R
mod mod4 = !!T
mod mod5 = !!Y
mod mod6 = !!U
mod mod7 = !!I
mod mod8 = !!O
mod mod9 = !!P
mod mod10 = !!A
mod mod11 = !!S
mod mod12 = !!D
mod mod13 = !!F
mod mod14 = !!G
mod mod15 = !!H
mod mod16 = !!J
mod mod17 = !!K
mod mod18 = !!L
mod mod19 = !!Z

#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Number Modifiers (All 10 number keys + letters)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
def numbermod *_1 = *LShift
def numbermod *_2 = *RShift
def numbermod *_3 = *LCtrl
def numbermod *_4 = *RCtrl
def numbermod *_5 = *LAlt
def numbermod *_6 = *RAlt
def numbermod *_7 = *LWin
def numbermod *_8 = *RWin
def numbermod *_9 = *LShift    # Duplicate for testing
def numbermod *_0 = *RShift    # Duplicate for testing

# Additional number modifiers (using letter keys not used for modal)
def numbermod *X = *LShift
def numbermod *C = *LCtrl
def numbermod *V = *LAlt
def numbermod *B = *LWin
def numbermod *N = *RShift
def numbermod *M = *RCtrl

#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Tap Behavior for Modal Triggers (all 20)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
def subst *Q = *F1
def subst *W = *F2
def subst *E = *F3
def subst *R = *F4
def subst *T = *F5
def subst *Y = *F6
def subst *U = *F7
def subst *I = *F8
def subst *O = *F9
def subst *P = *F10
def subst *A = *F11
def subst *S = *F12
# D, F, G, H, J, K, L, Z have passthrough behavior (no substitution)

# Number key substitutions
*_1 = *F1
*_2 = *F2
*_3 = *F3
*_4 = *F4
*_5 = *F5
*_6 = *F6
*_7 = *F7
*_8 = *F8
*_9 = *F9
*_0 = *F10

#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Single Modal Modifier Tests (one per mod0-mod19)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
key m0-*Comma = Period         # mod0+Comma → Period
key m1-*Comma = Slash
key m2-*Comma = Semicolon
key m3-*Comma = Colon
key m4-*Comma = OpenBracket
key m5-*Comma = CloseBracket
key m6-*Comma = Minus
key m7-*Comma = Caret
key m8-*Comma = Atmark
key m9-*Comma = BackSpace
key m10-*Comma = Tab
key m11-*Comma = Enter
key m12-*Comma = Space
key m13-*Comma = Escape
key m14-*Comma = Kanji
key m15-*Comma = Eisuu
key m16-*Comma = Left
key m17-*Comma = Right
key m18-*Comma = Up
key m19-*Comma = Down

#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Multiple Modal Modifiers (stress combinations)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
key m0-m1-*Period = _1         # mod0+mod1+Period → 1
key m0-m1-m2-*Period = _2      # mod0+mod1+mod2+Period → 2
key m0-m1-m2-m3-*Period = _3   # 4 modifiers
key m0-m1-m2-m3-m4-*Period = _4  # 5 modifiers

# Maximum modal combination (10 modifiers)
key m0-m1-m2-m3-m4-m5-m6-m7-m8-m9-*Slash = Q  # 10 modal modifiers

# All 20 modal modifiers (stress test)
key m0-m1-m2-m3-m4-m5-m6-m7-m8-m9-m10-m11-m12-m13-m14-m15-m16-m17-m18-m19-*Semicolon = Colon

#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Modal + Standard Modifiers (complex combinations)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
key *C-m0-*Atmark = _1
key *S-m1-*Atmark = _2
key *A-m2-*Atmark = _3
key *C-*S-m3-*Atmark = _4      # Ctrl+Shift+mod3+Atmark → 4
key *C-*A-m4-*Atmark = _5      # Ctrl+Alt+mod4+Atmark → 5

#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Same Key, Different Modal Modifiers (testing specificity)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
key m0-*OpenBracket = _1       # mod0+[ → 1
key m1-*OpenBracket = _2       # mod1+[ → 2
key m2-*OpenBracket = _3       # mod2+[ → 3
key m0-m1-*OpenBracket = _4    # mod0+mod1+[ → 4 (more specific)
key m0-m2-*OpenBracket = _5    # mod0+mod2+[ → 5
key m1-m2-*OpenBracket = _6    # mod1+mod2+[ → 6
key m0-m1-m2-*OpenBracket = _7 # mod0+mod1+mod2+[ → 7 (most specific)

#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Rapid Succession Tests (same modal modifier, different keys)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
key m9-*A = _1
key m9-*B = _2
key m9-*C = _3
key m9-*D = _4
key m9-*E = _5
key m9-*F = _6
key m9-*G = _7
key m9-*H = _8
key m9-*I = _9
key m9-*J = _0
key m9-*K = F1
key m9-*L = F2
key m9-*M = F3
key m9-*N = F4
key m9-*O = F5
key m9-*P = F6
key m9-*Q = F7
key m9-*R = F8
key m9-*S = F9
key m9-*T = F10

#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Edge Case: Chained Modal Modifiers
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Example: Press Q (mod0), then while holding Q, press W (mod1)
key m0-m1-m2-m3-m4-*CloseBracket = Escape

#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Expected Behavior (Stress Tests):
#
# 1. All 20 modal modifiers should be independently activatable
#    - Hold Q → mod0 active
#    - Hold W → mod1 active
#    - ... up to Z → mod19 active
#
# 2. Modal modifier bitmask should support all 20 bits concurrently
#    - Hold all 20 keys simultaneously
#    - Press Semicolon → Colon output
#
# 3. Number modifiers should work independently of modal modifiers
#    - Hold 1 (LShift), press A → Shift+A (system-wide)
#    - Hold Q (mod0), press Comma → Period (YAMY-only)
#
# 4. Specificity testing:
#    - Hold Q (mod0), press [ → 1
#    - Hold Q+W (mod0+mod1), press [ → 4 (more specific match)
#    - Hold Q+W+E (mod0+mod1+mod2), press [ → 7 (most specific)
#
# 5. Rapid key presses with modal active:
#    - Hold P (mod9)
#    - Quickly press A,B,C,D,E,F,G,H,I,J
#    - Should output: 1,2,3,4,5,6,7,8,9,0 (all sequential)
#
# 6. Tap behavior for all 20 modal triggers:
#    - Tap Q → F1
#    - Tap W → F2
#    - ... (all should work independently)
#
# 7. Number modifier combinations with modal modifiers:
#    - Hold 1 (LShift) + hold Q (mod0) + press Atmark
#    - Should output: 1 (Ctrl+mod0+Atmark match, but Shift is also active)
#
# 8. Maximum concurrent modifiers (stress):
#    - Hold Ctrl + Shift + Alt
#    - Hold Q+W+E+R+T (5 modal modifiers)
#    - Press a key
#    - Should match most specific entry
#
# 9. Performance test:
#    - 1000 rapid key presses while holding mod9
#    - All should be processed within latency budget (<1ms P99)
#
# 10. State cleanup:
#     - Hold all 20 modal modifiers
#     - Release all
#     - Verify all deactivated (bitmask = 0x00000000)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
